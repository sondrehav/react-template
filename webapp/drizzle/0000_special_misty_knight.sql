DO $$ BEGIN
 CREATE TYPE "public"."entryType" AS ENUM('pageView', 'load', 'error');
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "entries" (
	"entryId" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"projectId" uuid NOT NULL,
	"entryType" "entryType" NOT NULL,
	"data" jsonb NOT NULL,
	"createdAt" timestamp DEFAULT now()
);
--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "organizations" (
	"organizationId" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"name" varchar NOT NULL,
	"logoUrl" varchar DEFAULT 'data:image/svg+xml;charset=utf-8;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NCIgaGVpZ2h0PSI0MSIgZmlsbD0ibm9uZSIgdmlld0JveD0iMCAwIDU0IDQxIj48cGF0aCBmaWxsPSIjMkEyRTRFIiBkPSJNNTQgMS41YTEuNSAxLjUgMCAxIDEtMyAwIDEuNSAxLjUgMCAwIDEgMyAwWiI+PC9wYXRoPjxwYXRoIGZpbGw9IiMyQTJFNEUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTEzLjc1IDQwLjc5NEM2LjE1NiA0MC43OTQgMCAzNC42MzggMCAyNy4wNDRWMWg1djI2LjA0NGE4Ljc1IDguNzUgMCAwIDAgOC43NSA4Ljc1YzQuODkzIDAgOC43NS0zLjc3MSA4Ljc1LTguNTQ0aDV2Ny41YTEuMjUgMS4yNSAwIDAgMCAyLjUgMHYtOC44NzVhNi4yNSA2LjI1IDAgMCAxLTcuNS02LjEyNVY3LjI1YTYuMjUgNi4yNSAwIDEgMSAxMi41IDB2MjcuNWExLjI1IDEuMjUgMCAxIDAgMi41IDBWNy4yNWE2LjI1IDYuMjUgMCAxIDEgMTIuNSAwdjI3LjVhNi4yNSA2LjI1IDAgMCAxLTEwIDVBNi4yMjIgNi4yMjIgMCAwIDEgMzYuMjUgNDFhNi4yMjIgNi4yMjIgMCAwIDEtMy43NS0xLjI1IDYuMjUxIDYuMjUxIDAgMCAxLTkuNDY2LTIuNDdjLTIuNDU2IDIuMTk3LTUuNzIzIDMuNTE0LTkuMjg0IDMuNTE0Wm0zMC00Ljc5NGMtLjY5IDAtMS4yNS0uNTYtMS4yNS0xLjI1VjcuMjVhMS4yNSAxLjI1IDAgMSAxIDIuNSAwdjI3LjVjMCAuNjktLjU2IDEuMjUtMS4yNSAxLjI1Wk0zMCAxOS43NWExLjI1IDEuMjUgMCAwIDEtMi41IDBWNy4yNWExLjI1IDEuMjUgMCAxIDEgMi41IDB2MTIuNVoiIGNsaXAtcnVsZT0iZXZlbm9kZCI+PC9wYXRoPjxwYXRoIGZpbGw9IiMyQTJFNEUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTcuNSAyNy4yNWE2LjI1IDYuMjUgMCAxIDAgMTIuNSAwdi0yMGE2LjI1IDYuMjUgMCAxIDAtMTIuNSAwdjIwWm02LjI1IDEuMjVjLS42OSAwLTEuMjUtLjU2LTEuMjUtMS4yNXYtMjBhMS4yNSAxLjI1IDAgMSAxIDIuNSAwdjIwYzAgLjY5LS41NiAxLjI1LTEuMjUgMS4yNVoiIGNsaXAtcnVsZT0iZXZlbm9kZCI+PC9wYXRoPjwvc3ZnPg==',
	"createdAt" timestamp DEFAULT now()
);
--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "projects" (
	"projectId" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"organizationId" uuid NOT NULL,
	"name" varchar NOT NULL,
	"slug" varchar NOT NULL,
	"logoUrl" varchar DEFAULT 'data:image/svg+xml;charset=utf-8;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NCIgaGVpZ2h0PSI0MSIgZmlsbD0ibm9uZSIgdmlld0JveD0iMCAwIDU0IDQxIj48cGF0aCBmaWxsPSIjMkEyRTRFIiBkPSJNNTQgMS41YTEuNSAxLjUgMCAxIDEtMyAwIDEuNSAxLjUgMCAwIDEgMyAwWiI+PC9wYXRoPjxwYXRoIGZpbGw9IiMyQTJFNEUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTEzLjc1IDQwLjc5NEM2LjE1NiA0MC43OTQgMCAzNC42MzggMCAyNy4wNDRWMWg1djI2LjA0NGE4Ljc1IDguNzUgMCAwIDAgOC43NSA4Ljc1YzQuODkzIDAgOC43NS0zLjc3MSA4Ljc1LTguNTQ0aDV2Ny41YTEuMjUgMS4yNSAwIDAgMCAyLjUgMHYtOC44NzVhNi4yNSA2LjI1IDAgMCAxLTcuNS02LjEyNVY3LjI1YTYuMjUgNi4yNSAwIDEgMSAxMi41IDB2MjcuNWExLjI1IDEuMjUgMCAxIDAgMi41IDBWNy4yNWE2LjI1IDYuMjUgMCAxIDEgMTIuNSAwdjI3LjVhNi4yNSA2LjI1IDAgMCAxLTEwIDVBNi4yMjIgNi4yMjIgMCAwIDEgMzYuMjUgNDFhNi4yMjIgNi4yMjIgMCAwIDEtMy43NS0xLjI1IDYuMjUxIDYuMjUxIDAgMCAxLTkuNDY2LTIuNDdjLTIuNDU2IDIuMTk3LTUuNzIzIDMuNTE0LTkuMjg0IDMuNTE0Wm0zMC00Ljc5NGMtLjY5IDAtMS4yNS0uNTYtMS4yNS0xLjI1VjcuMjVhMS4yNSAxLjI1IDAgMSAxIDIuNSAwdjI3LjVjMCAuNjktLjU2IDEuMjUtMS4yNSAxLjI1Wk0zMCAxOS43NWExLjI1IDEuMjUgMCAwIDEtMi41IDBWNy4yNWExLjI1IDEuMjUgMCAxIDEgMi41IDB2MTIuNVoiIGNsaXAtcnVsZT0iZXZlbm9kZCI+PC9wYXRoPjxwYXRoIGZpbGw9IiMyQTJFNEUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTcuNSAyNy4yNWE2LjI1IDYuMjUgMCAxIDAgMTIuNSAwdi0yMGE2LjI1IDYuMjUgMCAxIDAtMTIuNSAwdjIwWm02LjI1IDEuMjVjLS42OSAwLTEuMjUtLjU2LTEuMjUtMS4yNXYtMjBhMS4yNSAxLjI1IDAgMSAxIDIuNSAwdjIwYzAgLjY5LS41NiAxLjI1LTEuMjUgMS4yNVoiIGNsaXAtcnVsZT0iZXZlbm9kZCI+PC9wYXRoPjwvc3ZnPg==',
	"createdAt" timestamp DEFAULT now()
);
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "entries" ADD CONSTRAINT "entries_projectId_projects_projectId_fk" FOREIGN KEY ("projectId") REFERENCES "public"."projects"("projectId") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "projects" ADD CONSTRAINT "projects_organizationId_organizations_organizationId_fk" FOREIGN KEY ("organizationId") REFERENCES "public"."organizations"("organizationId") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
CREATE INDEX IF NOT EXISTS "projectIdTypeIndex" ON "entries" USING btree ("projectId","entryType");--> statement-breakpoint
CREATE INDEX IF NOT EXISTS "projectIdCreatedAtIndex" ON "entries" USING btree ("projectId","createdAt");--> statement-breakpoint
CREATE UNIQUE INDEX IF NOT EXISTS "projectSlugUniqueIndex" ON "projects" USING btree ("slug","organizationId");